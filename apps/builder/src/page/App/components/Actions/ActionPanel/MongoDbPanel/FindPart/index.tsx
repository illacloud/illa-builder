import { FC } from "react"
import { useTranslation } from "react-i18next"
import { useDispatch, useSelector } from "react-redux"
import { CodeEditor } from "@/components/CodeEditor"
import { CODE_LANG } from "@/components/CodeEditor/CodeMirror/extensions/interface"
import { MongoDbActionPartProps } from "@/page/App/components/Actions/ActionPanel/MongoDbPanel/interface"
import {
  codeEditorLabelStyle,
  mongoItemCodeEditorStyle,
  mongoItemStyle,
} from "@/page/App/components/Actions/ActionPanel/MongoDbPanel/style"
import { getCachedAction } from "@/redux/config/configSelector"
import { configActions } from "@/redux/config/configSlice"
import { ActionItem } from "@/redux/currentApp/action/actionState"
import {
  FindContent,
  MongoDbAction,
  MongoDbActionTypeContent,
} from "@/redux/currentApp/action/mongoDbAction"
import { VALIDATION_TYPES } from "@/utils/validationFactory"

export const FindPart: FC<MongoDbActionPartProps> = (props) => {
  const { t } = useTranslation()

  const dispatch = useDispatch()
  const cachedAction = useSelector(getCachedAction) as ActionItem<
    MongoDbAction<MongoDbActionTypeContent>
  >
  const typeContent = props.typeContent as FindContent

  return (
    <>
      <div css={mongoItemStyle}>
        <span css={codeEditorLabelStyle}>
          {t("editor.action.panel.mongodb.query")}
        </span>
        <CodeEditor
          showLineNumbers
          height="88px"
          wrapperCss={mongoItemCodeEditorStyle}
          lang={CODE_LANG.JAVASCRIPT}
          value={typeContent.query}
          modalTitle={t("editor.action.panel.mongodb.query")}
          onChange={(value) => {
            dispatch(
              configActions.updateCachedAction({
                ...cachedAction,
                content: {
                  ...cachedAction.content,
                  typeContent: {
                    ...typeContent,
                    query: value,
                  } as FindContent,
                },
              }),
            )
          }}
          expectValueType={VALIDATION_TYPES.STRING}
        />
      </div>
      <div css={mongoItemStyle}>
        <span css={codeEditorLabelStyle}>
          {t("editor.action.panel.mongodb.projection")}
        </span>
        <CodeEditor
          showLineNumbers
          height="88px"
          wrapperCss={mongoItemCodeEditorStyle}
          lang={CODE_LANG.JAVASCRIPT}
          value={typeContent.projection}
          modalTitle={t("editor.action.panel.mongodb.projection")}
          onChange={(value) => {
            dispatch(
              configActions.updateCachedAction({
                ...cachedAction,
                content: {
                  ...cachedAction.content,
                  typeContent: {
                    ...typeContent,
                    projection: value,
                  } as FindContent,
                },
              }),
            )
          }}
          expectValueType={VALIDATION_TYPES.STRING}
        />
      </div>
      <div css={mongoItemStyle}>
        <span css={codeEditorLabelStyle}>
          {t("editor.action.panel.mongodb.sort_by")}
        </span>
        <CodeEditor
          showLineNumbers
          height="88px"
          wrapperCss={mongoItemCodeEditorStyle}
          lang={CODE_LANG.JAVASCRIPT}
          value={typeContent.sortBy}
          modalTitle={t("editor.action.panel.mongodb.sort_by")}
          onChange={(value) => {
            dispatch(
              configActions.updateCachedAction({
                ...cachedAction,
                content: {
                  ...cachedAction.content,
                  typeContent: {
                    ...typeContent,
                    sortBy: value,
                  } as FindContent,
                },
              }),
            )
          }}
          expectValueType={VALIDATION_TYPES.STRING}
        />
      </div>
      <div css={mongoItemStyle}>
        <span css={codeEditorLabelStyle}>
          {t("editor.action.panel.mongodb.limit")}
        </span>
        <CodeEditor
          showLineNumbers
          height="88px"
          wrapperCss={mongoItemCodeEditorStyle}
          lang={CODE_LANG.JAVASCRIPT}
          value={typeContent.limit}
          modalTitle={t("editor.action.panel.mongodb.limit")}
          onChange={(value) => {
            dispatch(
              configActions.updateCachedAction({
                ...cachedAction,
                content: {
                  ...cachedAction.content,
                  typeContent: {
                    ...typeContent,
                    limit: value,
                  } as FindContent,
                },
              }),
            )
          }}
          expectValueType={VALIDATION_TYPES.STRING}
        />
      </div>
      <div css={mongoItemStyle}>
        <span css={codeEditorLabelStyle}>
          {t("editor.action.panel.mongodb.skip")}
        </span>
        <CodeEditor
          showLineNumbers
          height="88px"
          wrapperCss={mongoItemCodeEditorStyle}
          lang={CODE_LANG.JAVASCRIPT}
          value={typeContent.skip}
          modalTitle={t("editor.action.panel.mongodb.skip")}
          onChange={(value) => {
            dispatch(
              configActions.updateCachedAction({
                ...cachedAction,
                content: {
                  ...cachedAction.content,
                  typeContent: {
                    ...typeContent,
                    skip: value,
                  } as FindContent,
                },
              }),
            )
          }}
          expectValueType={VALIDATION_TYPES.STRING}
        />
      </div>
    </>
  )
}

FindPart.displayName = "FindPart"
